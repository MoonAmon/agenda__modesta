{% extends "base.html" %}

{% block title %}{{ projeto.nome }} - Agenda Modesta{% endblock %}

{% block content %}
<div class="page-header">
  <div class="flex items-center gap-4">
    <a href="{% url 'projects:list' %}" class="text-gray-400 hover:text-gray-600">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
    </a>
    <div>
      <h1 class="page-title">{{ projeto.nome }}</h1>
      <p class="text-gray-500 mt-1">{{ projeto.cliente.nome }}</p>
    </div>
  </div>
  <div class="flex gap-2">
    <a href="{% url 'projects:edit' projeto.id %}" class="btn btn-secondary">
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
      </svg>
      Editar
    </a>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- Project Info -->
  <div class="lg:col-span-1">
    <div class="card">
      <div class="card-header">
        <h2 class="text-lg font-semibold text-gray-900">Informações</h2>
      </div>
      <div class="card-body space-y-4">
        <div>
          <p class="text-xs text-gray-500">Status</p>
          <span class="badge {% if projeto.status == 'EM_ANDAMENTO' %}badge-info{% elif projeto.status == 'CONCLUIDO' %}badge-success{% elif projeto.status == 'CANCELADO' %}badge-danger{% else %}badge-gray{% endif %}">
            {{ projeto.get_status_display }}
          </span>
        </div>

        <div>
          <p class="text-xs text-gray-500">Cliente</p>
          <a href="{% url 'clients:detail' projeto.cliente.id %}" class="text-primary-600 hover:text-primary-700 font-medium">
            {{ projeto.cliente.nome }}
          </a>
        </div>

        {% if projeto.descricao %}
        <div>
          <p class="text-xs text-gray-500">Descrição</p>
          <p class="text-sm text-gray-700">{{ projeto.descricao }}</p>
        </div>
        {% endif %}

        {% if projeto.data_inicio %}
        <div>
          <p class="text-xs text-gray-500">Data de Início</p>
          <p class="font-medium">{{ projeto.data_inicio|date:"d/m/Y" }}</p>
        </div>
        {% endif %}

        {% if projeto.data_prevista_conclusao %}
        <div>
          <p class="text-xs text-gray-500">Previsão de Conclusão</p>
          <p class="font-medium">{{ projeto.data_prevista_conclusao|date:"d/m/Y" }}</p>
        </div>
        {% endif %}

        {% if projeto.data_conclusao %}
        <div>
          <p class="text-xs text-gray-500">Data de Conclusão</p>
          <p class="font-medium text-green-600">{{ projeto.data_conclusao|date:"d/m/Y" }}</p>
        </div>
        {% endif %}

        <div>
          <p class="text-xs text-gray-500">Criado em</p>
          <p class="text-sm text-gray-600">{{ projeto.data_criacao|date:"d/m/Y H:i" }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Related Items -->
  <div class="lg:col-span-2 space-y-6">
    <!-- Agendamentos -->
    <div class="card">
      <div class="card-header flex items-center justify-between">
        <h2 class="text-lg font-semibold text-gray-900">Agendamentos</h2>
        <a href="{% url 'agenda:create' %}?projeto={{ projeto.id }}" class="text-sm text-primary-600 hover:text-primary-700">
          + Novo Agendamento
        </a>
      </div>
      <div class="card-body">
        {% if projeto.agendamentos.all %}
        <ul class="space-y-3">
          {% for agenda in projeto.agendamentos.all|slice:":5" %}
          <li class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-50">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-primary-100 flex flex-col items-center justify-center text-primary-700">
                <span class="text-xs">{{ agenda.data_inicio|date:"M" }}</span>
                <span class="text-sm font-bold leading-none">{{ agenda.data_inicio|date:"d" }}</span>
              </div>
              <div>
                <p class="font-medium text-gray-900">{{ agenda.titulo }}</p>
                <p class="text-xs text-gray-500">{{ agenda.data_inicio|date:"H:i" }}</p>
              </div>
            </div>
            {% if agenda.confirmado %}
            <span class="badge badge-success">Confirmado</span>
            {% else %}
            <span class="badge badge-warning">Pendente</span>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="text-center text-gray-500 py-8">Nenhum agendamento cadastrado</p>
        {% endif %}
      </div>
    </div>

    <!-- Orçamentos -->
    <div class="card">
      <div class="card-header flex items-center justify-between">
        <h2 class="text-lg font-semibold text-gray-900">Orçamentos</h2>
        <a href="{% url 'finance:orcamento_create' %}?projeto={{ projeto.id }}" class="text-sm text-primary-600 hover:text-primary-700">
          + Novo Orçamento
        </a>
      </div>
      <div class="card-body">
        {% if projeto.orcamentos.all %}
        <ul class="space-y-3">
          {% for orcamento in projeto.orcamentos.all|slice:":5" %}
          <li class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-50">
            <div>
              <p class="font-medium text-gray-900">Orçamento #{{ orcamento.numero_sequencial }}</p>
              <p class="text-xs text-gray-500">R$ {{ orcamento.valor_total }} - {{ orcamento.data_emissao|date:"d/m/Y" }}</p>
            </div>
            {% if orcamento.status_pagamento == 'pago' %}
            <span class="badge badge-success">Pago</span>
            {% else %}
            <span class="badge badge-warning">Pendente</span>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="text-center text-gray-500 py-8">Nenhum orçamento cadastrado</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
